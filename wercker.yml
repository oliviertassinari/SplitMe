box: node:5.6.0
build:
  steps:
    - npm-install
    - script:
        name: 'npm install material-ui'
        code: npm install material-ui
    - script:
        name: lint the code
        code: npm run lint
    - script:
        name: unit test
        code: npm run test:unit
    - script:
        name: build for testing the browser release
        code: npm run browser:production
    - script:
        name: build for testing the server release
        code: npm run server:production
    # - script:
    #     name: install e2e environment
    #     code: sudo ./e2e.sh
    # - script:
    #     name: selenium-standalone install
    #     code: npm install selenium-standalone -g && selenium-standalone install
    # - script:
    #     name: start selenium
    #     code: npm run test:selenium &
    # - script:
    #     name: start server
    #     code: npm run start &
    # - script:
    #     name: e2e test
    #     code: npm run test:e2e
    - script:
        name: install e2e environment
        code: sudo ./e2e.sh
    - script:
        name: selenium-standalone install
        code: npm install selenium-standalone -g && selenium-standalone install
    - script:
        name: start selenium
        code: npm run test:selenium &
    - script:
        name: start server
        code: npm run start &
    - script:
        name: e2e test
        code: npm run test:e2e
    - script:
        name: clean directory
        code: rm -rf .git

deploy:
  steps:
    - script:
        name: browser:production
        code: npm run browser:production
    - script:
        name: build command 1
        code: npm run $NPM_COMMAND1
    - script:
        name: build command 2
        code: npm run $NPM_COMMAND2
    - add-ssh-key:
        keyname: SSH_KEY
        host: $OPENSHIFT_HOST
    - add-to-known_hosts:
        hostname: $OPENSHIFT_HOST
    - script:
        name: git deploy openshift
        code: ./deploy.sh $OPENSHIFT_GIT_URL
